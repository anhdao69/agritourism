# Table of Contents
- prisma/seed.cjs
- prisma/schema.prisma
- prisma/tsconfig.json
- prisma/migrations/migration_lock.toml
- prisma/migrations/20250912150716_drop_impact_datum/migration.sql
- prisma/migrations/20250912134625_add_impact_datum/migration.sql
- prisma/migrations/20251112203121_add_user_status/migration.sql
- prisma/migrations/20251110214908_add_user_status_and_profile/migration.sql
- prisma/migrations/20250908152713_init/migration.sql

## File: prisma/seed.cjs

- Extension: .cjs
- Language: unknown
- Size: 1185 bytes
- Created: 2025-11-10 09:24:58
- Modified: 2025-09-08 11:27:48

### Code

```unknown
// prisma/seed.cjs
const { PrismaClient, Role } = require("@prisma/client");
const bcrypt = require("bcryptjs");

const prisma = new PrismaClient();

async function main() {
  const email = process.env.SEED_ADMIN_EMAIL || "admin@example.com";
  const pwd   = process.env.SEED_ADMIN_PASSWORD || "Admin123!";
  const hash  = await bcrypt.hash(pwd, 10);

  await prisma.user.upsert({
    where: { email },
    update: {
      role: Role.ADMIN,
      passwordHash: hash,
      emailVerified: new Date(),
      deletedAt: null,
      name: "Site Admin",
    },
    create: {
      email,
      name: "Site Admin",
      passwordHash: hash,
      role: Role.ADMIN,
      emailVerified: new Date(),
    },
  });

  // add into prisma/seed.cjs (optional example at end of main())
await prisma.listing.upsert({
  where: { slug: "miller-family-farm" },
  update: {},
  create: {
    name: "Miller Family Farm",
    slug: "miller-family-farm",
    shortIntro: "U-pick apples & cozy weekend events",
    status: "PUBLISHED",
  },
});

  console.log("Admin ensured at:", email);
}




main()
  .catch((e) => {
    console.error(e);
    process.exit(1);
  })
  .finally(() => prisma.$disconnect());

```

## File: prisma/schema.prisma

- Extension: .prisma
- Language: unknown
- Size: 3706 bytes
- Created: 2025-11-12 15:30:33
- Modified: 2025-11-12 15:30:33

### Code

```unknown
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "mysql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL") // <- add this
}

enum Role {
  VISITOR
  OWNER
  EDITOR
  ADMIN
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified DateTime?
  passwordHash  String?
  role          Role      @default(VISITOR)
  image         String?
  deletedAt     DateTime?

  status UserStatus @default(PENDING)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  institution  String?
  personalLink String?
  bio          String?

  accounts     Account[]
  sessions     Session[]
  activityLogs ActivityLog[]
  Listing      Listing[]

  @@index([role])
  @@index([deletedAt])
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

/**
 * Our own tokens to keep flows explicit
 */
model EmailVerificationToken {
  id        String   @id @default(cuid())
  email     String
  token     String   @unique
  expires   DateTime
  createdAt DateTime @default(now())
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  email     String
  token     String   @unique
  expires   DateTime
  createdAt DateTime @default(now())
}

model InviteToken {
  id        String    @id @default(cuid())
  email     String
  role      Role      @default(VISITOR)
  token     String    @unique
  expires   DateTime
  usedAt    DateTime?
  createdAt DateTime  @default(now())
}

model ActivityLog {
  id        String   @id @default(cuid())
  userId    String?
  action    String
  details   String?
  ip        String?
  userAgent String?
  createdAt DateTime @default(now())
  user      User?    @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId, createdAt])
}

enum ListingStatus {
  DRAFT
  PENDING
  PUBLISHED
  REJECTED
}

model Listing {
  id         String        @id @default(cuid())
  name       String
  slug       String        @unique
  shortIntro String?
  logoUrl    String?
  photos     Json?
  address1   String?
  city       String?
  region     String?
  postalCode String?
  country    String?
  phone      String?
  website    String?
  social     Json?
  hours      Json?
  amenities  Json?
  activities Json?
  status     ListingStatus @default(DRAFT)
  ownerId    String?
  owner      User?         @relation(fields: [ownerId], references: [id], onDelete: SetNull)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  deletedAt  DateTime?

  @@index([status, deletedAt])
  @@index([ownerId])
}

enum UserStatus {
  PENDING // Email sent but not verified
  VERIFIED // Email verified or admin-created
  ACTIVE // User is active and can use the system
  SUSPENDED // Account suspended by admin
  DELETED // Soft deleted
}

```

## File: prisma/tsconfig.json

- Extension: .json
- Language: json
- Size: 274 bytes
- Created: 2025-11-10 09:24:58
- Modified: 2025-09-05 16:21:58

### Code

```json
{
    "extends": "../tsconfig.json",
    "compilerOptions": {
        "module": "CommonJS",
        "moduleResolution": "Node",
        "target": "ES2020",
        "esModuleInterop": true,
        "types": [
            "node"
        ],
        "skipLibCheck": true
    }
}
```

## File: prisma/migrations/migration_lock.toml

- Extension: .toml
- Language: toml
- Size: 123 bytes
- Created: 2025-11-12 15:31:21
- Modified: 2025-11-12 15:31:21

### Code

```toml
# Please do not edit this file manually
# It should be added in your version-control system (e.g., Git)
provider = "mysql"

```

## File: prisma/migrations/20250912150716_drop_impact_datum/migration.sql

- Extension: .sql
- Language: sql
- Size: 176 bytes
- Created: 2025-11-10 09:24:58
- Modified: 2025-09-12 11:07:16

### Code

```sql
/*
  Warnings:

  - You are about to drop the `ImpactDatum` table. If the table is not empty, all the data it contains will be lost.

*/
-- DropTable
DROP TABLE `ImpactDatum`;

```

## File: prisma/migrations/20250912134625_add_impact_datum/migration.sql

- Extension: .sql
- Language: sql
- Size: 598 bytes
- Created: 2025-11-10 09:24:58
- Modified: 2025-09-12 09:46:25

### Code

```sql
-- CreateTable
CREATE TABLE `ImpactDatum` (
    `id` VARCHAR(191) NOT NULL,
    `modelId` VARCHAR(191) NOT NULL,
    `type` VARCHAR(191) NOT NULL,
    `displayCode` VARCHAR(191) NOT NULL,
    `displayDescription` VARCHAR(191) NOT NULL,
    `value` DECIMAL(24, 6) NOT NULL,
    `raw` JSON NULL,
    `uploadedBy` VARCHAR(191) NULL,
    `createdAt` DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),

    INDEX `ImpactDatum_modelId_type_idx`(`modelId`, `type`),
    INDEX `ImpactDatum_displayCode_idx`(`displayCode`),
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

```

## File: prisma/migrations/20251112203121_add_user_status/migration.sql

- Extension: .sql
- Language: sql
- Size: 143 bytes
- Created: 2025-11-12 15:31:21
- Modified: 2025-11-12 15:31:21

### Code

```sql
-- AlterTable
ALTER TABLE `User` ADD COLUMN `status` ENUM('PENDING', 'VERIFIED', 'ACTIVE', 'SUSPENDED', 'DELETED') NOT NULL DEFAULT 'PENDING';

```

## File: prisma/migrations/20251110214908_add_user_status_and_profile/migration.sql

- Extension: .sql
- Language: sql
- Size: 166 bytes
- Created: 2025-11-10 16:49:08
- Modified: 2025-11-10 16:49:08

### Code

```sql
-- AlterTable
ALTER TABLE `User` ADD COLUMN `bio` VARCHAR(191) NULL,
    ADD COLUMN `institution` VARCHAR(191) NULL,
    ADD COLUMN `personalLink` VARCHAR(191) NULL;

```

## File: prisma/migrations/20250908152713_init/migration.sql

- Extension: .sql
- Language: sql
- Size: 5478 bytes
- Created: 2025-11-10 09:24:58
- Modified: 2025-09-08 11:27:13

### Code

```sql
-- CreateTable
CREATE TABLE `User` (
    `id` VARCHAR(191) NOT NULL,
    `name` VARCHAR(191) NULL,
    `email` VARCHAR(191) NOT NULL,
    `emailVerified` DATETIME(3) NULL,
    `passwordHash` VARCHAR(191) NULL,
    `role` ENUM('VISITOR', 'OWNER', 'EDITOR', 'ADMIN') NOT NULL DEFAULT 'VISITOR',
    `image` VARCHAR(191) NULL,
    `deletedAt` DATETIME(3) NULL,
    `createdAt` DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
    `updatedAt` DATETIME(3) NOT NULL,

    UNIQUE INDEX `User_email_key`(`email`),
    INDEX `User_role_idx`(`role`),
    INDEX `User_deletedAt_idx`(`deletedAt`),
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- CreateTable
CREATE TABLE `Account` (
    `id` VARCHAR(191) NOT NULL,
    `userId` VARCHAR(191) NOT NULL,
    `type` VARCHAR(191) NOT NULL,
    `provider` VARCHAR(191) NOT NULL,
    `providerAccountId` VARCHAR(191) NOT NULL,
    `refresh_token` TEXT NULL,
    `access_token` TEXT NULL,
    `expires_at` INTEGER NULL,
    `token_type` VARCHAR(191) NULL,
    `scope` VARCHAR(191) NULL,
    `id_token` TEXT NULL,
    `session_state` VARCHAR(191) NULL,

    UNIQUE INDEX `Account_provider_providerAccountId_key`(`provider`, `providerAccountId`),
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- CreateTable
CREATE TABLE `Session` (
    `id` VARCHAR(191) NOT NULL,
    `sessionToken` VARCHAR(191) NOT NULL,
    `userId` VARCHAR(191) NOT NULL,
    `expires` DATETIME(3) NOT NULL,

    UNIQUE INDEX `Session_sessionToken_key`(`sessionToken`),
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- CreateTable
CREATE TABLE `VerificationToken` (
    `identifier` VARCHAR(191) NOT NULL,
    `token` VARCHAR(191) NOT NULL,
    `expires` DATETIME(3) NOT NULL,

    UNIQUE INDEX `VerificationToken_token_key`(`token`),
    UNIQUE INDEX `VerificationToken_identifier_token_key`(`identifier`, `token`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- CreateTable
CREATE TABLE `EmailVerificationToken` (
    `id` VARCHAR(191) NOT NULL,
    `email` VARCHAR(191) NOT NULL,
    `token` VARCHAR(191) NOT NULL,
    `expires` DATETIME(3) NOT NULL,
    `createdAt` DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),

    UNIQUE INDEX `EmailVerificationToken_token_key`(`token`),
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- CreateTable
CREATE TABLE `PasswordResetToken` (
    `id` VARCHAR(191) NOT NULL,
    `email` VARCHAR(191) NOT NULL,
    `token` VARCHAR(191) NOT NULL,
    `expires` DATETIME(3) NOT NULL,
    `createdAt` DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),

    UNIQUE INDEX `PasswordResetToken_token_key`(`token`),
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- CreateTable
CREATE TABLE `InviteToken` (
    `id` VARCHAR(191) NOT NULL,
    `email` VARCHAR(191) NOT NULL,
    `role` ENUM('VISITOR', 'OWNER', 'EDITOR', 'ADMIN') NOT NULL DEFAULT 'VISITOR',
    `token` VARCHAR(191) NOT NULL,
    `expires` DATETIME(3) NOT NULL,
    `usedAt` DATETIME(3) NULL,
    `createdAt` DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),

    UNIQUE INDEX `InviteToken_token_key`(`token`),
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- CreateTable
CREATE TABLE `ActivityLog` (
    `id` VARCHAR(191) NOT NULL,
    `userId` VARCHAR(191) NULL,
    `action` VARCHAR(191) NOT NULL,
    `details` VARCHAR(191) NULL,
    `ip` VARCHAR(191) NULL,
    `userAgent` VARCHAR(191) NULL,
    `createdAt` DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),

    INDEX `ActivityLog_userId_createdAt_idx`(`userId`, `createdAt`),
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- CreateTable
CREATE TABLE `Listing` (
    `id` VARCHAR(191) NOT NULL,
    `name` VARCHAR(191) NOT NULL,
    `slug` VARCHAR(191) NOT NULL,
    `shortIntro` VARCHAR(191) NULL,
    `logoUrl` VARCHAR(191) NULL,
    `photos` JSON NULL,
    `address1` VARCHAR(191) NULL,
    `city` VARCHAR(191) NULL,
    `region` VARCHAR(191) NULL,
    `postalCode` VARCHAR(191) NULL,
    `country` VARCHAR(191) NULL,
    `phone` VARCHAR(191) NULL,
    `website` VARCHAR(191) NULL,
    `social` JSON NULL,
    `hours` JSON NULL,
    `amenities` JSON NULL,
    `activities` JSON NULL,
    `status` ENUM('DRAFT', 'PENDING', 'PUBLISHED', 'REJECTED') NOT NULL DEFAULT 'DRAFT',
    `ownerId` VARCHAR(191) NULL,
    `createdAt` DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
    `updatedAt` DATETIME(3) NOT NULL,
    `deletedAt` DATETIME(3) NULL,

    UNIQUE INDEX `Listing_slug_key`(`slug`),
    INDEX `Listing_status_deletedAt_idx`(`status`, `deletedAt`),
    INDEX `Listing_ownerId_idx`(`ownerId`),
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- AddForeignKey
ALTER TABLE `Account` ADD CONSTRAINT `Account_userId_fkey` FOREIGN KEY (`userId`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE `Session` ADD CONSTRAINT `Session_userId_fkey` FOREIGN KEY (`userId`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE `ActivityLog` ADD CONSTRAINT `ActivityLog_userId_fkey` FOREIGN KEY (`userId`) REFERENCES `User`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE `Listing` ADD CONSTRAINT `Listing_ownerId_fkey` FOREIGN KEY (`ownerId`) REFERENCES `User`(`id`) ON DELETE SET NULL ON UPDATE CASCADE;

```

